(function(n,t){var r=function(n){if(/^https?:\/\//.test(n))return n;var i=location.pathname,t,r,u=[];for(i=i.substr(0,i.lastIndexOf("/")),i=i.split("/"),t=0,r=i.length;t<r;t++)i[t]!==""&&u.push(i[t]);for(n=n.split("/"),t=0,r=n.length;t<r;t++)n[t]===".."?u.pop():n[t]!=="."&&u.push(n[t]);return location.protocol+"//"+location.host+"/"+u.join("/")},u=function(t){var f=r(t),i=n("<a href='"+f+"'><\/a>")[0],u=i.protocol+"//"+i.hostname;return(i.protocol==="http:"&&i.port!=="80"||i.protocol==="https:"&&i.port!=="443")&&(u+=i.port?":"+i.port:""),u},f=function(n,t){window.attachEvent?window.attachEvent(n,t):window.addEventListener(n,t,!1)},e=function(n,t){window.detachEvent?window.detachEvent(n,t):window.removeEventListener(n,t,!1)},i;n.fn.downloadfile=function(r){n("iframe[name^='file_download']").remove();var a=this,h,c=(new Date).getTime().toString(),v="file_download"+c,l=n('<iframe name="'+v+'" style="width: 0; height: 0; position:absolute;top:-9999px" />').appendTo("body"),s='<form target="'+v+'" method="get" accept-charset="UTF-8" />',o=n.Deferred(),y;r=n.extend(!0,{url:window.location.href,data:{__key:c}},r);y=u(r.url);s=a.wrapAll(s).parent().attr("action",r.url);h=i(r.data,s);s.on("submit",function(){var n={result:!1,message:"ダウンロードの結果を取得できませんでした。"},r=!1,u=function(t){var f;if(e("onmessage",u),!r){if(r=!0,t.origin!==y||!t.data)return o.reject(n),i();try{f=new Function("return "+t.data.replace(/\r?\n/g," ")+";")()}catch(s){return n.message+=s,o.reject(n),i()}if(!f||!f.key||f.key!==c)return n.message+="結果がない、もしくはキーが一致しません。",o.reject(n),i();i();o[f.result?"resolve":"reject"](f)}},i=function(){for(var n=0,t=h.length,n=0;n<t;n++)h[n].remove();a.unwrap();l.remove()};l.on("load",function(){var e,c,h,s,v,a=!0;if(f("onmessage",u),!r){r=!0;try{e=l.contents()}catch(y){return n.message+=y,o.reject(n),i()}c=e.find(".result").text();h=e.find(".message").text();s=e.find(".data").text();c||h||s||(c=!1,h="予期しないエラーが発生しました。管理者に問い合わせてください。",e[0]&&e[0].documentElement&&(h+=e[0].title,v=e[0].documentElement.outerHTML||e[0].documentElement.innerHTML));i();a=c?c.toString().toUpperCase()==="TRUE":!1;a||h||(h="予期しないエラーが発生しました。管理者に問い合わせてください。");s&&(s=JSON.parse(s));a?o.resolve({result:!0,message:h,data:!s?t:s}):o.reject({result:!1,message:h,data:!s?t:s,responseText:v})}})});return s.submit(),o.promise()};i=function(t,i){var f=[],r;for(var u in t)t.hasOwnProperty(u)&&(r=n("<input type='hidden' name='"+u+"'>").attr("value",t[u]),i.append(r),f.push(r));return f}})(jQuery);
/*
//# sourceMappingURL=downloadfile.min.js.map
*/