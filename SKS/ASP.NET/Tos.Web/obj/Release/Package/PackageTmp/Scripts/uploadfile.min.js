(function(n,t){var r=function(n){if(/^https?:\/\//.test(n))return n;var i=location.pathname,t,r,u=[];for(i=i.substr(0,i.lastIndexOf("/")),i=i.split("/"),t=0,r=i.length;t<r;t++)i[t]!==""&&u.push(i[t]);for(n=n.split("/"),t=0,r=n.length;t<r;t++)n[t]===".."?u.pop():n[t]!=="."&&u.push(n[t]);return location.protocol+"//"+location.host+"/"+u.join("/")},i;n.fn.uploadfile=function(u){var h=this,v,y=(new Date).getTime().toString(),w="file_upload"+y,l,o,f=n.Deferred(),b,a=!1,e={result:!1,message:"アップロードの結果を取得できませんでした。"},c=function(){for(var n=0,i=v.length,t,n=0;n<i;n++)v[n].remove();t=h.parent('form[target^="file_upload"]');t.length&&h.unwrap();l.remove()},s=function(n){var i;if(!a){if(a=!0,window.detachEvent?window.detachEvent("onmessage",s):window.removeEventListener("message",s),n.origin!==b||!n.data)return f.reject(e),c();try{i=new Function("return "+n.data.replace(/\r?\n/g," ")+";")()}catch(r){return e.message+=r,f.reject(e),c()}i&&i.key&&i.key===y&&(c(),i.result?f.resolve({result:!0,message:i.message,data:!i.data?t:i.data}):f.reject({result:!1,message:i.message,data:!i.data?t:i.data}))}},p;return n('iframe[name^="file_upload"]').remove(),p=h.parent('form[target^="file_upload"]'),p.length&&(p.find('input[name="__key"]input[type="hidden"]').remove(),h.unwrap()),l=n('<iframe name="'+w+'" style="width: 0; height: 0; position:absolute;top:-9999px" />').appendTo("body"),o='<form target="'+w+'" method="post" enctype="multipart/form-data" accept-charset="UTF-8" />',u=n.extend(!0,{url:window.location.href,data:{__key:y}},u),b=function(){var f=r(u.url),t=n("<a href='"+f+"'><\/a>")[0],i=t.protocol+"//"+t.hostname;return(t.protocol==="http:"&&t.port!=="80"||t.protocol==="https:"&&t.port!=="443")&&(i+=t.port?":"+t.port:""),i}(),o=h.wrapAll(o).parent().attr("action",u.url),v=i(u.data,o),o.submit(function(){window.detachEvent?window.detachEvent("onmessage",s):window.removeEventListener("message",s);window.attachEvent?window.attachEvent("onmessage",s):window.addEventListener("message",s,!1);l.on("load",function(){var n,u,i,r,o=!0,s;if(!a){a=!0;try{n=l.contents()}catch(h){return e.message+=h,e.responseText+=h,e.status+=500,e.statusText+=500,f.reject(e),c()}u=n.find(".result").text();i=n.find(".message").text();r=n.find(".data").text();u||i||r||(u=!1,i="予期しないエラーが発生しました。管理者に問い合わせてください。",n[0]&&n[0].documentElement&&(i+=i=n[0].title,s=n[0].documentElement.outerHTML||n[0].documentElement.innerHTML));c();o=u?u.toString().toUpperCase()==="TRUE":!1;o||i||(i="予期しないエラーが発生しました。管理者に問い合わせてください。");r&&(r=JSON.parse(r));o?f.resolve({result:!0,message:i,data:!r?t:r}):f.reject({result:!1,message:i,data:!r?t:r,responseText:s})}})}),setTimeout(function(){o.submit()},500),f.promise()};i=function(t,i){var f=[],r;for(var u in t)t.hasOwnProperty(u)&&(r=n("<input type='hidden' name='"+u+"' value='"+t[u]+"'>"),i.append(r),f.push(r));return f}})(jQuery);
/*
//# sourceMappingURL=uploadfile.min.js.map
*/