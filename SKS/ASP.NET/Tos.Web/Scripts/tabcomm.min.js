(function(n){function c(){this._subscribers=new Map}function u(n,r,u,f){if(n&&n.postMessage){var e=t+"/"+r+"/"+u+(!f?"":"/"+JSON.stringify(f));n.postMessage(e,i.location.origin)}}function l(n){var s=n||{};const f=!i.opener?undefined:!Object.keys(i.opener).length?undefined:i.opener,o=(new Date).getTime();r(this).id=o;f&&!!s.connectToOpener&&(r(this).opener=f,u(f,o,t+"."+e.addedChild,{}),i.addEventListener("beforeunload",function(){u(f,o,t+"."+e.beforeUnloadChild,{})}.bind(this)),i.addEventListener("unload",function(){u(f,o,t+"."+e.unloadChild,{})}.bind(this)))}var i=new Function("return this;")(),t="$$__tabcomm__",f=new Map,s;let h;var r=function(){var n=new WeakMap;return function(t){return n.has(t)||n.set(t,{}),n.get(t)}}(),e={addedChild:"addedChild",beforeUnloadChild:"beforeUnloadChild",unloadChild:"unloadChild"},o={};o[e.addedChild]=function(n,t){return f.set(t,n),!0};o[e.beforeUnloadChild]=function(){return!0};o[e.unloadChild]=function(n,t){return f.delete(t),!0};c.prototype.on=function(n,t){this._subscribers.has(n)||this._subscribers.set(n,[]);var i=this._subscribers.get(n);i.push(t)};c.prototype.off=function(n,t){if(this._subscribers.has(n)){var i=this._subscribers.get(n),r=i.indexOf(t);r>-1&&i.splice(r,1)}};c.prototype.emit=function(n,i,r,u){if(h){if(r.indexOf(t+".")>-1){let f=r.substr((t+".").length);if(o[f]&&!o[f](n,i,u))return;r=f}if(this._subscribers.has(r)){var f=this._subscribers.get(r);f.forEach(function(t){t({source:n.source,key:i,data:u})})}}};s=new c;i.addEventListener("message",function(n){var o,r,u;if(n.origin===i.location.origin&&(o=n.data+"",o.substr(0,t.length+1)===t+"/")&&(r=o.substr(t.length+1),u=r.indexOf("/"),!(u<1))){var h=r.substr(0,u),f=r.substr(u+1),e=f.indexOf("/");if(e!==0){if(e<0){s.emit(n.source,h,f);return}var c=f.substr(0,e),l=f.substr(e+1),a=JSON.parse(l);s.emit(n.source,h,c,a)}}});l.prototype=Object.create(Object.prototype,{sendToOpener:{value:function(n,t){r(this).opener&&u(r(this).opener,r(this).id,n,t)}},sendToChild:{value:function(n,t,i){f.has(n)&&u(f.get(n),r(this).id,t,i)}},sendToChildren:{value:function(n,t){f.forEach(function(i,e){u(f.get(e),r(this).id,n,t)})}},sendTo:{value:function(n,t,i){u(n,r(this).id,t,i)}},on:{value:function(n,t){s.on(n,t)}},off:{value:function(n,t){s.off(n,t)}}});n.ui.tabComm=Object.create(null,{getOrCreate:{value:function(n){return h||(h=new l(n)),h}}})})(App);
/*
//# sourceMappingURL=tabcomm.min.js.map
*/